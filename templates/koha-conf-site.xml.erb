<yazgfs>

<!-- This file is managed by Puppet! Any modifications will be overwritten. -->

<listen id="biblioserver" >unix:/var/run/koha/<%= @site_name %>/bibliosocket</listen>
<listen id="authorityserver" >unix:/var/run/koha/<%= @site_name %>/authoritysocket</listen>

<!-- Uncomment the following entry if you want to run the public Z39.50 server.
    Also uncomment the <server> and <serverinfo> sections for id 'publicserver'
    under PUBLICSERVER'S BIBLIOGRAPHIC RECORDS title-->
<% if @koha_zebra_sru_hostname %>
<!--
<% end %>
<listen id="publicserver" >tcp:@:<%= @koha_zebra_sru_biblios_port %></listen>
<% if @koha_zebra_sru_hostname %>
-->
<% end %>

<!-- Settings for special biblio server instance for PazPar2.
     Because PazPar2 only connects to a Z39.50 server using TCP/IP,
     it cannot use the Unix-domain socket that biblioserver uses.
     Therefore, a custom server is defined. -->
<!--
<listen id="mergeserver">tcp:@:__MERGE_SERVER_PORT__</listen>
<server id="mergeserver"  listenref="mergeserver">
    <directory>/var/lib/koha/<%= @site_name %>/biblios</directory>
    <config>/etc/koha/sites/<%= @site_name %>/<%= @koha_zebra_biblios_config %></config>
    <cql2rpn>/var/lib/koha/<%= @site_name %>/pqf.properties</cql2rpn>
</server>
-->

<!-- BIBLIOGRAPHIC RECORDS -->
<server id="biblioserver"  listenref="biblioserver">
    <directory>/var/lib/koha/<%= @site_name %>/biblios</directory>
    <config>/etc/koha/sites/<%= @site_name %>/<%= @koha_zebra_biblios_config %></config>
    <cql2rpn>/etc/koha/zebradb/pqf.properties</cql2rpn>

<% if @koha_zebra_biblios_indexing_mode == "dom" %>
    <xi:include href="/etc/koha/<%= @koha_zebra_marc_format %>-retrieval-info-bib-dom.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
     <xi:fallback>
      <retrievalinfo>
<% elsif @koha_zebra_biblios_indexing_mode == "grs1" %>
    <retrievalinfo>
<% end %>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="F"/>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="B"/>
       <retrieval syntax="xml" name="F"/>
       <retrieval syntax="xml" name="B"/>
       <retrieval syntax="xml" name="marcxml"
                  identifier="info:srw/schema/1/marcxml-v1.1">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="dc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2DC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="mods">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2MODS.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="rdfdc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2RDFDC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="rss2">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2RSS2.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="utils">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slimUtils.xsl"/>
         </backend>
       </retrieval>
<% if @koha_zebra_biblios_indexing_mode == "dom" %>
      </retrievalinfo>
     </xi:fallback>
    </xi:include>
<% elsif @koha_zebra_biblios_indexing_mode == "grs1" %>
    </retrievalinfo>
<% end %>

<% if @koha_zebra_sru_hostname %>
<!--
<% end %>
    <xi:include href="<%= @koha_config_dir %>/zebradb/explain-biblios.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
      <xi:fallback>
      <explain xmlns="http://explain.z3950.org/dtd/2.0/">
          <serverInfo>
            <host><%= @koha_zebra_sru_hostname %></host>
            <port><%= @koha_zebra_sru_biblios_port %></port>
            <database>biblios</database>
          </serverInfo>
        </explain>
      </xi:fallback>
    </xi:include>
<% if @koha_zebra_sru_hostname %>
-->
<% end %>
</server>
<serverinfo id="biblioserver">
        <ccl2rpn>/etc/koha/zebradb/ccl.properties</ccl2rpn>
        <user>kohauser</user>
        <password><%= @zebra_password %></password>
</serverinfo>

<!-- AUTHORITY RECORDS -->
<server id="authorityserver"  listenref="authorityserver" >
    <directory>/var/lib/koha/<%= @site_name %>/authorities</directory>
    <config>/etc/koha/sites/<%= @site_name %>/<%= @koha_zebra_authorities_config %></config>
    <cql2rpn>/etc/koha/zebradb/pqf.properties</cql2rpn>

<% if @koha_zebra_authorities_indexing_mode == "dom" %>
    <xi:include href="/etc/koha/<%= @koha_zebra_marc_format %>-retrieval-info-auth-dom.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
     <xi:fallback>
      <retrievalinfo>
<% elsif @koha_zebra_authorities_indexing_mode == "grs1" %>
    <retrievalinfo>
<% end %>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="F"/>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="B"/>
       <retrieval syntax="xml" name="marcxml"
                  identifier="info:srw/schema/1/marcxml-v1.1">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="dc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2DC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="mods">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2MODS.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="rdfdc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2RDFDC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="utils">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slimUtils.xsl"/>
         </backend>
       </retrieval>
<% if @koha_zebra_authorities_indexing_mode == "dom" %>
      </retrievalinfo>
     </xi:fallback>
    </xi:include>
<% elsif @koha_zebra_authorities_indexing_mode == "grs1" %>
    </retrievalinfo>
<% end %>

<% if @koha_zebra_sru_hostname %>
<!--
<% end %>
    <xi:include href="<%= @koha_config_dir %>/zebradb/explain-authorities.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
    <xi:fallback>
      <explain xmlns="http://explain.z3950.org/dtd/2.0/">
          <serverInfo>
            <host><%= @koha_zebra_sru_hostname %></host>
            <port><%= @koha_zebra_sru_authorities_port %></port>
            <database>authorities</database>
          </serverInfo>
        </explain>
      </xi:fallback>
  </xi:include>
<% if @koha_zebra_sru_hostname %>
-->
<% end %>
</server>
<serverinfo id="authorityserver">
    <ccl2rpn>/etc/koha/zebradb/ccl.properties</ccl2rpn>
    <user>kohauser</user>
    <password><%= @zebra_password %></password>
</serverinfo>

<!-- PUBLICSERVER'S BIBLIOGRAPHIC RECORDS -->
<!-- This can be used to set up a public Z39.50/SRU server. -->
<% if @koha_zebra_sru_hostname %>
<!--
<% end %>
<server id="publicserver"  listenref="publicserver">
    <directory>/var/lib/koha/<%= @site_name %>/biblios</directory>
    <config>/etc/koha/sites/<%= @site_name %>/<%= @koha_zebra_biblios_config %></config>
    <cql2rpn>/etc/koha/zebradb/pqf.properties</cql2rpn>

<% if @koha_zebra_biblios_indexing_mode == "dom" %>
    <xi:include href="/etc/koha/<%= @koha_zebra_marc_format %>-retrieval-info-bib-dom.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
     <xi:fallback>
      <retrievalinfo>
<% elsif @koha_zebra_biblios_indexing_mode == "grs1" %>
    <retrievalinfo>
<% end %>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="F"/>
       <retrieval syntax="<%= @koha_zebra_marc_format %>" name="B"/>
       <retrieval syntax="xml" name="F"/>
       <retrieval syntax="xml" name="B"/>
       <retrieval syntax="xml" name="marcxml"
                  identifier="info:srw/schema/1/marcxml-v1.1">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="dc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2DC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="mods">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2MODS.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="rdfdc">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2RDFDC.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="rss2">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slim2RSS2.xsl"/>
         </backend>
       </retrieval>
       <retrieval syntax="xml" name="utils">
         <backend syntax="<%= @koha_zebra_marc_format %>" name="F">
           <marc inputformat="marc" outputformat="marcxml"
                 inputcharset="utf-8"/>
           <xslt stylesheet="/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/xslt/MARC21slimUtils.xsl"/>
         </backend>
       </retrieval>
<% if @koha_zebra_biblios_indexing_mode == "dom" %>
      </retrievalinfo>
     </xi:fallback>
    </xi:include>
<% elsif @koha_zebra_bibliosindexing_mode == "grs1" %>
    </retrievalinfo>
<% end %>

    <xi:include href="<%= @koha_config_dir %>/zebradb/explain-biblios.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude">
      <xi:fallback>
      <explain xmlns="http://explain.z3950.org/dtd/2.0/">
          <serverInfo>
            <host><%= @koha_zebra_sru_hostname %></host>
            <port><%= @koha_zebra_sru_biblios_port %></port>
            <database>biblios</database>
          </serverInfo>
        </explain>
      </xi:fallback>
    </xi:include>
</server>
<serverinfo id="publicserver">
        <ccl2rpn>/etc/koha/zebradb/ccl.properties</ccl2rpn>
        <user>kohauser</user>
        <password><%= @zebra_password %></password>
</serverinfo>
<% if @koha_zebra_sru_hostname %>
-->
<% end %>

<config>
 <db_scheme>mysql</db_scheme>
 <database><%= @mysql_db_ %></database>
 <hostname><%= @mysql_hostname %></hostname>
 <port><%= @mysql_port %></port>
 <user><%= @mysql_user_ %></user>
 <pass><%= @mysql_password %></pass>
 <biblioserver>biblios</biblioserver>
 <biblioservershadow>1</biblioservershadow>
 <authorityserver>authorities</authorityserver>
 <authorityservershadow>1</authorityservershadow>
 <pluginsdir<%= @koha_plugins_dir_ %></pluginsdir>
 <enable_plugins>0</enable_plugins>
 <intranetdir>/usr/share/koha/intranet/cgi-bin</intranetdir>
 <opacdir>/usr/share/koha/opac/cgi-bin/opac</opacdir>
 <opachtdocs>/usr/share/koha/opac/htdocs/opac-tmpl</opachtdocs>
 <intrahtdocs>/usr/share/koha/intranet/htdocs/intranet-tmpl</intrahtdocs>
 <includes>/usr/share/koha/intranet/htdocs/intranet-tmpl/prog/en/includes/</includes>
 <logdir>/var/log/koha/<%= @site_name %></logdir>
 <docdir>/usr/share/doc/koha-common</docdir>
 <backupdir>/var/spool/koha/<%= @site_name %></backupdir>
 <!-- Enable the two following to allow superlibrarians to download
      database and configuration dumps (respectively) from the Export
      tool -->
 <backup_db_via_tools>0</backup_db_via_tools>
 <backup_conf_via_tools>0</backup_conf_via_tools>
 <!-- <pazpar2url>http://__PAZPAR2_HOST__:__PAZPAR2_PORT__/search.pz2</pazpar2url> -->
 <install_log>/usr/share/koha/misc/koha-install-log</install_log>
 <useldapserver>0</useldapserver><!-- see C4::Auth_with_ldap for extra configs you must add if you want to turn this on -->
 <useshibboleth>0</useshibboleth><!-- see C4::Auth_with_shibboleth for extra configs you must do to turn this on -->
 <zebra_bib_index_mode><%= @koha_zebra_biblios_indexing_mode %></zebra_bib_index_mode>
 <zebra_auth_index_mode><%= @koha_zebra_authorities_indexing_mode %></zebra_auth_index_mode>
 <zebra_lockdir>/var/lock/koha/<%= @site_name %></zebra_lockdir>
 <use_zebra_facets>1</use_zebra_facets>
 <queryparser_config>/etc/koha/searchengine/queryparser.yaml</queryparser_config>

<!-- true type font mapping accoding to type from $font_types in C4/Creators/Lib.pm -->
 <ttf>
    <font type="TR" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSerif.ttf</font>
    <font type="TB" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSerif-Bold.ttf</font>
    <font type="TI" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSerif-Italic.ttf</font>
    <font type="TBI">/usr/share/fonts/truetype/ttf-dejavu/DejaVuSerif-BoldItalic.ttf</font>
    <font type="C"  >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSansMono.ttf</font>
    <font type="CB" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSansMono-Bold.ttf</font>
    <font type="CO" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSansMono-Oblique.ttf</font>
    <font type="CBO">/usr/share/fonts/truetype/ttf-dejavu/DejaVuSansMono-BoldOblique.ttf</font>
    <font type="H"  >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf</font>
    <font type="HO" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans-Oblique.ttf</font>
    <font type="HB" >/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans-Bold.ttf</font>
    <font type="HBO">/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans-BoldOblique.ttf</font>
 </ttf>

</config>
</yazgfs>
